<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ include file="/WEB-INF/views/cert/plugin.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<body>
	<a href="/group/home.do"> 그룹 </a>
	<a href="/cert/home.do"> 인증서 </a>
	<a href="/user/home.do"> 사용자</a>
	<a href="/audit/home.do"> 감사로그 </a>
	
	<a href="javascript:;" onclick="logout()">
		<span>로그아웃</span>
	</a> 
	<h2>초기 Root인증서 생성(once)</h2>
	<a href="javascript:;" onclick="registerRootCa()">
		<span>생성</span>
	</a> 
	<h2>회원 가입 요청</h2>
	<table id="userApplyTable" border=1>
		<tr>
			<th>번호</th>
			<th>이름</th>
			<th>팀</th>
			<th>직급</th>
			<th>요청분류</th>
			<th>요청날짜</th>
			<th>승인</th>
		</tr>
	</table>
	<div id='userApplyPagination'></div>
	
	<h2>그룹 솔루션 추가 요청</h2>
</body>


<script>
var navi = 10;

$(function(){
	goAppliedUserList(1);
});

function goAppliedUserList( page ) {
	var sendData = {
			"page": page
	};
	
	$.ajax({
		url: '/admin/appliedUserList.do',
		type: 'POST',
		data: JSON.stringify(sendData),
		dataType: 'json',
		success: function(list) { 
			var i =0;
			var j =0;
			var navi2 = list.data.length;
			
			for ( i=0; i<navi; i++ ) {
				if ( i < navi2 ) {
					if ( $("#userApplyTable tr").length <= (i + 1)) {
						$("#userApplyTable").append("<tr class='trC' value='" + list.data[i].seqid + "'>" +
								"<td>" + list.data[i].seqid + "</td>" +
								"<td>" + list.data[i].name + "</td>" +
								"<td>" + list.data[i].departteam + "</td>" +
								"<td>" + list.data[i].joblevel + "</td>" +
								"<td>" + list.data[i].reqtype + "</td>" +
								"<td>" + list.data[i].adddate + "</td>" + 
								"<td><a href=javascript:; onclick=registerAppliedUser('" + list.data[i].seqid + "')>승인</a></td>" + 
							"</tr>");
					} else {  
						$("#userApplyTable").find('td').eq(j++).text( list.data[i].seqid );
						$("#userApplyTable").find('td').eq(j++).text( list.data[i].name );
						$("#userApplyTable").find('td').eq(j++).text( list.data[i].departteam );
						$("#userApplyTable").find('td').eq(j++).text( list.data[i].joblevel );
						$("#userApplyTable").find('td').eq(j++).text( list.data[i].reqtype );
						$("#userApplyTable").find('td').eq(j++).text( list.data[i].adddate );
						j++;
					}
				} else if ( i == navi2 && (i+1) == $("#userApplyTable tr").length ) {
					break; 
				} else {
					$('#userApplyTable > tbody:last > tr:last').remove();
				}
			}
				
			printPaging(list.pageMaker, "goAppliedUserList", "userApplyPagination" );
		}
	});
}

function registerAppliedUser( id ) {
	$.ajax({
		url: '/admin/appliedUser/' + id,
		type: 'POST',
		success: function(list) {
			reloadTable( $("#userApplyTable tr").length, "userApplyTable", "goAppliedUserList" );
			alert( '등록 성공');
		},
		error: function (xhr, ajaxOptions, thrownError) {
			reloadTable( $("#userApplyTable tr").length, "userApplyTable", "goAppliedUserList" );
			alert(xhr.status);
		}
	});
}

function registerRootCa() {
	$.ajax({
		url: '/admin/registerRootCa.do',
		type: 'POST',
		success: function( data ) {
			alert( '등록 성공');
		},
		error: function (xhr, ajaxOptions, thrownError) {
			alert(xhr.status);
		}
	});
}
</script>
	
</html>